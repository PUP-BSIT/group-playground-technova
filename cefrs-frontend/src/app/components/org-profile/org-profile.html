<div class="profile-layout">
  <app-sidebar currentView="settings" (viewChanged)="onViewChanged($event)"></app-sidebar>
  
  <div class="main-content">
    <div class="profile-container">
      <div class="nav-header">
        <h1 class="page-title">Organization Profile</h1>
      </div>

      @if (loading) {
        <p>Loading profile...</p>
      } @else {
        <div class="profile-card">
          <h2 class="org-header">
            {{ user?.organizationName | uppercase }}
          </h2>

          <form [formGroup]="profileForm">
            <div class="form-grid">
              <div class="form-group">
                <label>Organization Name</label>
                <input 
                  type="text" 
                  formControlName="organizationName" 
                  [disabled]="!isEditing"
                  [class.invalid]="profileForm.get('organizationName')?.touched && profileForm.get('organizationName')?.invalid"
                />
                @if (profileForm.get('organizationName')?.touched && profileForm.get('organizationName')?.invalid) {
                  <small class="error">Organization name is required.</small>
                }
              </div>

              <div class="form-group">
                <label>Contact Person</label>
                <input 
                  type="text" 
                  formControlName="contactPerson" 
                  [disabled]="!isEditing"
                />
              </div>

              <div class="form-group">
                <label>Mobile No.</label>
                <input
                  type="text"
                  formControlName="phoneNumber"
                  [disabled]="!isEditing"
                  [class.invalid]="profileForm.get('phoneNumber')?.touched && profileForm.get('phoneNumber')?.invalid"
                />
                @if (profileForm.get('phoneNumber')?.touched && profileForm.get('phoneNumber')?.invalid) {
                  <small class="error">Enter a valid mobile number.</small>
                }
              </div>

              <div class="form-group">
                <label>Email Address</label>
                <input
                  type="email"
                  formControlName="email"
                  [disabled]="!isEditing"
                  [class.invalid]="profileForm.get('email')?.touched && profileForm.get('email')?.invalid"
                />
                @if (profileForm.get('email')?.touched && profileForm.get('email')?.invalid) {
                  <small class="error">Enter a valid email address.</small>
                }
              </div>

              <div class="form-group full-width">
                <label>Address</label>
                <input
                  type="text"
                  formControlName="address"
                  [disabled]="!isEditing"
                />
              </div>
            </div>

            <div class="action-buttons">
              @if (!isEditing) {
                <button type="button" class="btn-edit" (click)="toggleEdit()">Edit Profile</button>
                <button type="button" class="btn-password" (click)="goToChangePassword()">Change Password</button>
              } @else {
                <button type="button" class="btn-save" (click)="saveProfile()" [disabled]="profileForm.invalid">Save Changes</button>
                <button type="button" class="btn-cancel" (click)="cancelEdit()">Cancel</button>
              }
            </div>

            @if (successMessage) {
              <div class="success-message">{{ successMessage }}</div>
            }

            @if (errorMessage) {
              <div class="error-message">{{ errorMessage }}</div>
            }
          </form>
        </div>
      }
    </div>
  </div>
</div>