<div class="view-container">
  <h1 class="page-title">Facilities</h1>
  
  <div class="filter-section">
    <button class="add-button" (click)="addNewFacility()">+ Add New Facility</button>
    <div class="search-box">
      <input type="text" placeholder="Search by name or location..." [(ngModel)]="searchText">
      <button class="search-button">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
      </button>
    </div>
    <select class="filter-dropdown" [(ngModel)]="selectedStatus">
      <option>All Status</option>
      <option>Available</option>
      <option>Reserved</option>
      <option>Unavailable</option>
    </select>
  </div>

  <div class="items-list">
    @for (facility of filteredFacilities; track facility.id) {
      <div class="item-card">
        <div class="item-card-header">
          <div>
            <span class="item-id">{{ facility.id }}</span>
            <span [class]="'status-badge status-' + facility.status">{{ getStatusText(facility.status) }}</span>
          </div>
          <div class="item-actions">
            <button class="edit-button" (click)="editFacility(facility)">Edit</button>
            <button class="delete-button" (click)="deleteFacility(facility)">Delete</button>
          </div>
        </div>
        <h3 class="item-title">{{ facility.name }}</h3>
        <div class="item-details">
          <div class="detail-item">
            <span class="detail-label">Building:</span>
            <span class="detail-value">{{ facility.building }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Capacity:</span>
            <span class="detail-value">{{ facility.capacity }}</span>
          </div>
          @if (facility.description) {
            <div class="detail-item">
              <span class="detail-label">Description:</span>
              <span class="detail-value">{{ facility.description }}</span>
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>

<!-- Add/Edit Facility Modal -->
@if (showAddEditModal) {
  <div class="modal-overlay" (click)="closeAddEditModal()">
    <div class="modal-container modal-form-container" (click)="$event.stopPropagation()">
      <h2 class="modal-title">{{ isEditMode ? 'Edit Facility' : 'Add New Facility' }}</h2>
      
      <div class="modal-form">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Facility Name</label>
            <input 
              type="text" 
              class="form-input" 
              [(ngModel)]="facilityForm.name"
              placeholder="Enter facility name">
          </div>
          
          <div class="form-group">
            <label class="form-label">Building</label>
            <input 
              type="text" 
              class="form-input" 
              [(ngModel)]="facilityForm.building"
              placeholder="Enter building">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Capacity</label>
            <input 
              type="number" 
              class="form-input" 
              [(ngModel)]="facilityForm.capacity"
              placeholder="Enter capacity"
              min="1">
          </div>
          
          <div class="form-group">
            <label class="form-label">Status</label>
            <select class="form-select" [(ngModel)]="facilityForm.status">
              <option value="AVAILABLE">Available</option>
              <option value="RESERVED">Reserved</option>
              <option value="UNAVAILABLE">Unavailable</option>
            </select>
          </div>
        </div>

        <!-- Photo Upload Section -->
        <div class="form-group form-group-full">
          <label class="form-label">Upload Photo</label>
          
          <div class="file-upload-container">
            <input 
              type="file" 
              #fileInput
              (change)="onFileSelected($event)"
              accept="image/*"
              style="display: none;">
            
            @if (!photoPreview) {
              <div class="file-upload-area" (click)="fileInput.click()">
                <div class="upload-icon">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                    <path d="M7 18C4.23858 18 2 15.7614 2 13C2 10.2386 4.23858 8 7 8C7.36064 8 7.71474 8.02951 8.05848 8.08582C8.02169 7.7308 8 7.36905 8 7C8 4.23858 10.2386 2 13 2C15.4193 2 17.4403 3.71825 17.9163 6C20.1608 6.18684 22 8.16229 22 10.5C22 12.9853 19.9853 15 17.5 15H16" stroke="#94A3B8" stroke-width="2" stroke-linecap="round"/>
                    <path d="M12 12V21M12 12L9 15M12 12L15 15" stroke="#94A3B8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <p class="upload-text">Drag & Drop your files here</p>
                <p class="upload-or">OR</p>
                <button type="button" class="browse-button">Browse Files</button>
              </div>
            }

            @if (photoPreview) {
              <div class="photo-preview">
                <img [src]="photoPreview" alt="Preview">
                <button type="button" class="remove-photo-button" (click)="removePhoto()">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
            }
          </div>
        </div>

        <div class="form-group form-group-full">
          <label class="form-label">Description (optional)</label>
          <textarea 
            class="form-textarea" 
            [(ngModel)]="facilityForm.description"
            placeholder="Describe the facility...">
          </textarea>
        </div>
      </div>

      <div class="modal-actions">
        <button 
          class="modal-button modal-button-confirm" 
          (click)="saveAddEdit()"
          [disabled]="!isFormValid()">
          {{ isEditMode ? 'Save Changes' : 'Add Facility' }}
        </button>
        <button class="modal-button modal-button-cancel" (click)="closeAddEditModal()">Cancel</button>
      </div>
    </div>
  </div>
}

<!-- Delete Confirmation Modal -->
@if (showDeleteModal) {
  <div class="modal-overlay" (click)="closeDeleteModal()">
    <div class="modal-container modal-delete-container" (click)="$event.stopPropagation()">
      <h2 class="modal-title">Confirm Delete</h2>
      
      <div class="delete-message">
        <p>Are you sure you want to delete <strong>{{ selectedFacility?.name }}</strong>?</p>
        <p>This action cannot be undone.</p>
      </div>

      <div class="modal-actions">
        <button class="modal-button modal-button-confirm" (click)="confirmDelete()">Confirm</button>
        <button class="modal-button modal-button-cancel" (click)="closeDeleteModal()">Cancel</button>
      </div>
    </div>
  </div>
}