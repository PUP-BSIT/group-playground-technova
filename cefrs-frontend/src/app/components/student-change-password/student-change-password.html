<div class="profile-layout">
  <app-sidebar currentView="settings" (viewChanged)="onViewChanged($event)"></app-sidebar>
  
  <div class="main-content">
    <div class="profile-container">
  <div class="nav-header">
    <button class="back-btn" (click)="goBackToProfile()">
      <i class="back-icon">‚Üê</i> Back to Profile
    </button>
    <h1 class="page-title">Change Password</h1>
  </div>

  <div class="profile-card">
    <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
      <div class="form-grid">
        <div class="form-group">
          <label for="currentPassword">Current Password</label>
          <div class="input-with-icon">
            <input
              id="currentPassword"
              [type]="showCurrentPassword ? 'text' : 'password'"
              formControlName="currentPassword"
              [class.invalid]="f['currentPassword'].touched && f['currentPassword'].invalid"
            />
            <button 
              type="button" 
              class="toggle-password"
              (click)="toggleCurrentPasswordVisibility()"
              [attr.aria-label]="showCurrentPassword ? 'Hide password' : 'Show password'"
            >
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path
                  d="M10 4.375C5.625 4.375 2.06 6.8 0.625 10C2.06 13.2 5.625 15.625 10 15.625C14.375 15.625 17.94 13.2 19.375 10C17.94 6.8 14.375 4.375 10 4.375ZM10 13.75C7.9375 13.75 6.25 12.0625 6.25 10C6.25 7.9375 7.9375 6.25 10 6.25C12.0625 6.25 13.75 7.9375 13.75 10C13.75 12.0625 12.0625 13.75 10 13.75ZM10 7.8125C8.8125 7.8125 7.8125 8.8125 7.8125 10C7.8125 11.1875 8.8125 12.1875 10 12.1875C11.1875 12.1875 12.1875 11.1875 12.1875 10C12.1875 8.8125 11.1875 7.8125 10 7.8125Z"
                  fill="#999"
                />
              </svg>
            </button>
          </div>
          @if (f['currentPassword'].touched && f['currentPassword'].invalid) {
            <small class="error">Current password is required.</small>
          }
        </div>

        <div class="form-group">
          <label for="newPassword">New Password</label>
          <div class="input-with-icon">
            <input
              id="newPassword"
              [type]="showNewPassword ? 'text' : 'password'"
              formControlName="newPassword"
              [class.invalid]="f['newPassword'].touched && f['newPassword'].invalid"
            />
            <button 
              type="button" 
              class="toggle-password"
              (click)="toggleNewPasswordVisibility()"
              [attr.aria-label]="showNewPassword ? 'Hide password' : 'Show password'"
            >
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path
                  d="M10 4.375C5.625 4.375 2.06 6.8 0.625 10C2.06 13.2 5.625 15.625 10 15.625C14.375 15.625 17.94 13.2 19.375 10C17.94 6.8 14.375 4.375 10 4.375ZM10 13.75C7.9375 13.75 6.25 12.0625 6.25 10C6.25 7.9375 7.9375 6.25 10 6.25C12.0625 6.25 13.75 7.9375 13.75 10C13.75 12.0625 12.0625 13.75 10 13.75ZM10 7.8125C8.8125 7.8125 7.8125 8.8125 7.8125 10C7.8125 11.1875 8.8125 12.1875 10 12.1875C11.1875 12.1875 12.1875 11.1875 12.1875 10C12.1875 8.8125 11.1875 7.8125 10 7.8125Z"
                  fill="#999"
                />
              </svg>
            </button>
          </div>
          @if (f['newPassword'].touched && f['newPassword'].hasError('required')) {
            <small class="error">New password is required.</small>
          }
          @if (f['newPassword'].touched && f['newPassword'].hasError('minlength')) {
            <small class="error">Must be at least 6 characters.</small>
          }
          @if (f['newPassword'].touched && f['newPassword'].hasError('weakPassword')) {
            <small class="error">Password must contain uppercase, lowercase, numbers, and special characters.</small>
          }
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <div class="input-with-icon">
            <input
              id="confirmPassword"
              [type]="showConfirmPassword ? 'text' : 'password'"
              formControlName="confirmPassword"
              [class.invalid]="f['confirmPassword'].touched && f['confirmPassword'].invalid"
            />
            <button 
              type="button" 
              class="toggle-password"
              (click)="toggleConfirmPasswordVisibility()"
              [attr.aria-label]="showConfirmPassword ? 'Hide password' : 'Show password'"
            >
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path
                  d="M10 4.375C5.625 4.375 2.06 6.8 0.625 10C2.06 13.2 5.625 15.625 10 15.625C14.375 15.625 17.94 13.2 19.375 10C17.94 6.8 14.375 4.375 10 4.375ZM10 13.75C7.9375 13.75 6.25 12.0625 6.25 10C6.25 7.9375 7.9375 6.25 10 6.25C12.0625 6.25 13.75 7.9375 13.75 10C13.75 12.0625 12.0625 13.75 10 13.75ZM10 7.8125C8.8125 7.8125 7.8125 8.8125 7.8125 10C7.8125 11.1875 8.8125 12.1875 10 12.1875C11.1875 12.1875 12.1875 11.1875 12.1875 10C12.1875 8.8125 11.1875 7.8125 10 7.8125Z"
                  fill="#999"
                />
              </svg>
            </button>
          </div>
          @if (f['confirmPassword'].touched && f['confirmPassword'].hasError('required')) {
            <small class="error">Please confirm your password.</small>
          }
          @if (passwordForm.hasError('passwordMismatch') && f['confirmPassword'].touched) {
            <small class="error">Passwords do not match.</small>
          }
        </div>
      </div>

      <div class="form-footer">
        @if (isFormDirty) {
          <button type="button" class="cancel-btn" (click)="goBackToProfile()" [disabled]="isSubmitting">
            Cancel
          </button>
        }
        <button type="submit" class="save-btn" [disabled]="isSubmitting">
          {{ isSubmitting ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>

      @if (successMessage) {
        <div class="alert success">{{ successMessage }}</div>
      }
      @if (errorMessage) {
        <div class="alert error">{{ errorMessage }}</div>
      }
    </form>
  </div>
  </div>
</div>
