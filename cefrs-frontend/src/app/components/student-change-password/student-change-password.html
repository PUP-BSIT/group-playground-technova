<div class="profile-layout">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo">System name<br /><span>and logo</span></div>

    <nav class="menu">
      <button class="menu-item" (click)="goToDashboard()">Dashboard</button>
      <button class="menu-item">Facilities</button>
      <button class="menu-item">Equipment</button>
      <button class="menu-item">My Request</button>
      
      <!-- Settings with dropdown -->
      <div class="settings-wrapper">
        <button class="menu-item active" (click)="toggleSettingsDropdown()">
          Settings
          <span class="arrow" [class.open]="isSettingsOpen">▼</span>
        </button>
        <div class="settings-dropdown" [class.show]="isSettingsOpen">
          <button class="submenu-item" (click)="goToEditProfile()">Edit Profile</button>
          <button class="submenu-item active" (click)="goToChangePassword()">Change Password</button>
        </div>
      </div>
    </nav>

    <div class="student-info">
      <div class="avatar"></div>
      <div class="details">
        <div class="name">{{ userName }}</div>
        <div class="email">{{ userEmail }}</div>
      </div>
      <div class="logout-icon" (click)="logout()" title="Logout">⇦</div>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main-content">
    <h1>Change Password</h1>

    <div class="profile-card">
      <form [formGroup]="passwordForm" (ngSubmit)="changePassword()" novalidate>
        <div class="header">
          <h2>Update Your Password</h2>
        </div>

        <div class="password-content">
          <!-- Current Password -->
          <div class="form-group">
            <label for="currentPassword">Current Password <span class="required">*</span></label>
            <div class="password-input-wrapper">
              <input 
                [type]="showCurrentPassword ? 'text' : 'password'"
                id="currentPassword"
                formControlName="currentPassword"
                placeholder="Enter your current password"
                [class.error]="hasError('currentPassword', 'required') || hasError('currentPassword', 'minlength')"
              />
              <button 
                type="button" 
                class="toggle-visibility"
                (click)="togglePasswordVisibility('current')"
                tabindex="-1"
              >
                {{ showCurrentPassword ? '👁️' : '👁️‍🗨️' }}
              </button>
            </div>
            <div class="error-message" *ngIf="hasError('currentPassword', 'required')">
              Current password is required
            </div>
            <div class="error-message" *ngIf="hasError('currentPassword', 'minlength')">
              Password must be at least 6 characters
            </div>
          </div>

          <!-- New Password -->
          <div class="form-group">
            <label for="newPassword">New Password <span class="required">*</span></label>
            <div class="password-input-wrapper">
              <input 
                [type]="showNewPassword ? 'text' : 'password'"
                id="newPassword"
                formControlName="newPassword"
                placeholder="Enter your new password"
                [class.error]="hasError('newPassword', 'required') || hasError('newPassword', 'minlength') || hasError('newPassword', 'weakPassword')"
              />
              <button 
                type="button" 
                class="toggle-visibility"
                (click)="togglePasswordVisibility('new')"
                tabindex="-1"
              >
                {{ showNewPassword ? '👁️' : '👁️‍🗨️' }}
              </button>
            </div>
            <div class="error-message" *ngIf="hasError('newPassword', 'required')">
              New password is required
            </div>
            <div class="error-message" *ngIf="hasError('newPassword', 'minlength')">
              Password must be at least 8 characters
            </div>
            <div class="error-message" *ngIf="hasError('newPassword', 'weakPassword')">
              Password must contain uppercase, lowercase, number, and special character
            </div>
          </div>

          <!-- Confirm Password -->
          <div class="form-group">
            <label for="confirmPassword">Confirm New Password <span class="required">*</span></label>
            <div class="password-input-wrapper">
              <input 
                [type]="showConfirmPassword ? 'text' : 'password'"
                id="confirmPassword"
                formControlName="confirmPassword"
                placeholder="Re-enter your new password"
                [class.error]="hasError('confirmPassword', 'required') || passwordForm.hasError('passwordMismatch')"
              />
              <button 
                type="button" 
                class="toggle-visibility"
                (click)="togglePasswordVisibility('confirm')"
                tabindex="-1"
              >
                {{ showConfirmPassword ? '👁️' : '👁️‍🗨️' }}
              </button>
            </div>
            <div class="error-message" *ngIf="hasError('confirmPassword', 'required')">
              Please confirm your new password
            </div>
            <div class="error-message" *ngIf="passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched">
              Passwords do not match
            </div>
          </div>

          <!-- Password Requirements -->
          <div class="password-requirements">
            <p class="requirements-title">Password Requirements:</p>
            <ul>
              <li>At least 8 characters long</li>
              <li>Contains uppercase letter (A-Z)</li>
              <li>Contains lowercase letter (a-z)</li>
              <li>Contains number (0-9)</li>
              <li>Contains special character (!@#$%^&*)</li>
            </ul>
          </div>
        </div>

        <!-- Alert Message -->
        <div *ngIf="alertMessage" class="alert" [class.success]="alertType === 'success'" [class.error]="alertType === 'error'">
          {{ alertMessage }}
        </div>

        <!-- Action Buttons -->
        <div class="footer">
          <button class="btn-cancel" type="button" (click)="cancel()" [disabled]="isLoading">
            Cancel
          </button>
          <button class="btn-save" type="submit" [disabled]="isLoading || passwordForm.invalid">
            {{ isLoading ? 'Changing...' : 'Change Password' }}
          </button>
        </div>
      </form>
    </div>
  </main>
</div>