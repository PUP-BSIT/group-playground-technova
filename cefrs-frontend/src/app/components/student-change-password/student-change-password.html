<div class="profile-layout">
  <app-sidebar currentView="settings" (viewChanged)="onViewChanged($event)"></app-sidebar>
  
  <div class="main-content">
    <div class="profile-container">
  <div class="nav-header">
    <button class="back-btn" (click)="goBackToProfile()">
      <i class="back-icon">‚Üê</i> Back to Profile
    </button>
    <h1 class="page-title">Change Password</h1>
  </div>

  <div class="profile-card">
    <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
      <div class="form-grid">
        <div class="form-group">
          <label for="currentPassword">Current Password</label>
          <input
            id="currentPassword"
            type="password"
            formControlName="currentPassword"
            [class.invalid]="f['currentPassword'].touched && f['currentPassword'].invalid"
          />
          @if (f['currentPassword'].touched && f['currentPassword'].invalid) {
            <small class="error">Current password is required.</small>
          }
        </div>

        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input
            id="newPassword"
            type="password"
            formControlName="newPassword"
            [class.invalid]="f['newPassword'].touched && f['newPassword'].invalid"
          />
          @if (f['newPassword'].touched && f['newPassword'].hasError('required')) {
            <small class="error">New password is required.</small>
          }
          @if (f['newPassword'].touched && f['newPassword'].hasError('minlength')) {
            <small class="error">Must be at least 6 characters.</small>
          }
          @if (f['newPassword'].touched && f['newPassword'].hasError('weakPassword')) {
            <small class="error">Password must contain uppercase, lowercase, numbers, and special characters.</small>
          }
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <input
            id="confirmPassword"
            type="password"
            formControlName="confirmPassword"
            [class.invalid]="f['confirmPassword'].touched && f['confirmPassword'].invalid"
          />
          @if (f['confirmPassword'].touched && f['confirmPassword'].hasError('required')) {
            <small class="error">Please confirm your password.</small>
          }
          @if (passwordForm.hasError('passwordMismatch') && f['confirmPassword'].touched) {
            <small class="error">Passwords do not match.</small>
          }
        </div>
      </div>

      <div class="form-footer">
        @if (isFormDirty) {
          <button type="button" class="cancel-btn" (click)="goBackToProfile()" [disabled]="isSubmitting">
            Cancel
          </button>
        }
        <button type="submit" class="save-btn" [disabled]="isSubmitting">
          {{ isSubmitting ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>

      @if (successMessage) {
        <div class="alert success">{{ successMessage }}</div>
      }
      @if (errorMessage) {
        <div class="alert error">{{ errorMessage }}</div>
      }
    </form>
  </div>
  </div>
</div>
