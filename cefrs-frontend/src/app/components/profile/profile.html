<div class="profile-layout">
  <app-sidebar currentView="settings" (viewChanged)="onViewChanged($event)"></app-sidebar>
  
  <div class="main-content">
    <div class="profile-container">
      <div class="nav-header">
        <h1 class="page-title">Personal Data</h1>
      </div>

      @if (loading) {
        <p>Loading profile...</p>
      } @else {
    <div class="profile-card">
      <h2 class="user-header">
        {{ user?.lastName | uppercase }}, {{ user?.firstName | uppercase }}
        <span class="student-id">({{ user?.studentNumber }})</span>
      </h2>

      <form [formGroup]="profileForm">
        <div class="form-grid">
          <div class="form-group">
            <label>Student Number</label>
            <input type="text" formControlName="studentNumber" [disabled]="true" />
          </div>

          <div class="form-group">
            <label>Name</label>
            <input type="text" formControlName="name" [disabled]="true" />
          </div>

          <div class="form-group">
            <label>Mobile No.</label>
            <input
              type="text"
              formControlName="phoneNumber"
              [disabled]="!isEditing"
              [class.invalid]="profileForm.get('phoneNumber')?.touched && profileForm.get('phoneNumber')?.invalid"
            />
            @if (profileForm.get('phoneNumber')?.touched && profileForm.get('phoneNumber')?.invalid) {
              <small class="error">Enter a valid mobile number.</small>
            }
          </div>

          <div class="form-group">
            <label>Email Address</label>
            <input
              type="email"
              formControlName="email"
              [disabled]="!isEditing"
              [class.invalid]="profileForm.get('email')?.touched && profileForm.get('email')?.invalid"
            />
            @if (profileForm.get('email')?.touched && profileForm.get('email')?.invalid) {
              <small class="error">Enter a valid email.</small>
            }
          </div>

          <div class="form-group">
            <label>Address</label>
            <input
              type="text"
              formControlName="address"
              [disabled]="!isEditing"
              [class.invalid]="profileForm.get('address')?.touched && profileForm.get('address')?.invalid"
            />
            @if (profileForm.get('address')?.touched && profileForm.get('address')?.invalid) {
              <small class="error">Address is required.</small>
            }
          </div>
        </div>

        <div class="button-group">
          <button
            type="button"
            class="edit-btn"
            (click)="toggleEdit()"
            *ngIf="!isEditing"
          >
            Edit Profile
          </button>

          <button
            type="button"
            class="save-btn"
            (click)="saveProfile()"
            *ngIf="isEditing"
          >
            Save Changes
          </button>

          <button
            type="button"
            class="change-pass-btn"
            (click)="goToChangePassword()">
            Change Password
          </button>

        </div>

        @if (successMessage) {
          <div class="alert success">{{ successMessage }}</div>
        }
        @if (errorMessage) {
          <div class="alert error">{{ errorMessage }}</div>
        }
      </form>
    </div>
    }
  </div>
</div>
